<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一文吃透react事件原理 | 前端收集</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/logo.webp">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="前端相关知识归纳总结">
    <meta name="keywords" content="blog,react,node,js">
    
    <link rel="preload" href="/assets/css/0.styles.b4a844ec.css" as="style"><link rel="preload" href="/assets/js/app.ae400df5.js" as="script"><link rel="preload" href="/assets/js/2.57da4f88.js" as="script"><link rel="preload" href="/assets/js/1.a76cc220.js" as="script"><link rel="preload" href="/assets/js/492.088a7e6e.js" as="script"><link rel="prefetch" href="/assets/js/10.50f73657.js"><link rel="prefetch" href="/assets/js/100.f9ccbc6f.js"><link rel="prefetch" href="/assets/js/101.c20baa36.js"><link rel="prefetch" href="/assets/js/102.4ce575e4.js"><link rel="prefetch" href="/assets/js/103.6ddf9f4a.js"><link rel="prefetch" href="/assets/js/104.e8bd0c3f.js"><link rel="prefetch" href="/assets/js/105.d0a85c47.js"><link rel="prefetch" href="/assets/js/106.4b3aadee.js"><link rel="prefetch" href="/assets/js/107.436e7f8f.js"><link rel="prefetch" href="/assets/js/108.f46692dc.js"><link rel="prefetch" href="/assets/js/109.322908a6.js"><link rel="prefetch" href="/assets/js/11.0390ceee.js"><link rel="prefetch" href="/assets/js/110.9181da82.js"><link rel="prefetch" href="/assets/js/111.c451b4da.js"><link rel="prefetch" href="/assets/js/112.196b195d.js"><link rel="prefetch" href="/assets/js/113.d65148d0.js"><link rel="prefetch" href="/assets/js/114.5566de19.js"><link rel="prefetch" href="/assets/js/115.12d1619e.js"><link rel="prefetch" href="/assets/js/116.d2f23fe7.js"><link rel="prefetch" href="/assets/js/117.d5fa2588.js"><link rel="prefetch" href="/assets/js/118.79455d12.js"><link rel="prefetch" href="/assets/js/119.b43c99e9.js"><link rel="prefetch" href="/assets/js/12.f88bec36.js"><link rel="prefetch" href="/assets/js/120.f321d53f.js"><link rel="prefetch" href="/assets/js/121.286fed99.js"><link rel="prefetch" href="/assets/js/122.ff0af27d.js"><link rel="prefetch" href="/assets/js/123.00138c02.js"><link rel="prefetch" href="/assets/js/124.25640250.js"><link rel="prefetch" href="/assets/js/125.cb2f28a6.js"><link rel="prefetch" href="/assets/js/126.e8ec0fe7.js"><link rel="prefetch" href="/assets/js/127.0fdd48c2.js"><link rel="prefetch" href="/assets/js/128.38b675a9.js"><link rel="prefetch" href="/assets/js/129.7819df5c.js"><link rel="prefetch" href="/assets/js/13.963ad03b.js"><link rel="prefetch" href="/assets/js/130.a58f0a09.js"><link rel="prefetch" href="/assets/js/131.4a0133b5.js"><link rel="prefetch" href="/assets/js/132.24e842c4.js"><link rel="prefetch" href="/assets/js/133.be3bb854.js"><link rel="prefetch" href="/assets/js/134.8c4662c6.js"><link rel="prefetch" href="/assets/js/135.03d2f395.js"><link rel="prefetch" href="/assets/js/136.acf07647.js"><link rel="prefetch" href="/assets/js/137.f0fa48ad.js"><link rel="prefetch" href="/assets/js/138.843d86f2.js"><link rel="prefetch" href="/assets/js/139.015086b5.js"><link rel="prefetch" href="/assets/js/14.512f15b9.js"><link rel="prefetch" href="/assets/js/140.5468056b.js"><link rel="prefetch" href="/assets/js/141.9bf65de6.js"><link rel="prefetch" href="/assets/js/142.63b38359.js"><link rel="prefetch" href="/assets/js/143.55120954.js"><link rel="prefetch" href="/assets/js/144.e3d71ef2.js"><link rel="prefetch" href="/assets/js/145.470a4869.js"><link rel="prefetch" href="/assets/js/146.574b3929.js"><link rel="prefetch" href="/assets/js/147.28c0b405.js"><link rel="prefetch" href="/assets/js/148.08f963f8.js"><link rel="prefetch" href="/assets/js/149.0b296978.js"><link rel="prefetch" href="/assets/js/15.a674496c.js"><link rel="prefetch" href="/assets/js/150.651bd19a.js"><link rel="prefetch" href="/assets/js/151.d2029876.js"><link rel="prefetch" href="/assets/js/152.32f253ce.js"><link rel="prefetch" href="/assets/js/153.ceb29b56.js"><link rel="prefetch" href="/assets/js/154.6a7f6d29.js"><link rel="prefetch" href="/assets/js/155.50aaf5d9.js"><link rel="prefetch" href="/assets/js/156.036e250b.js"><link rel="prefetch" href="/assets/js/157.c2435840.js"><link rel="prefetch" href="/assets/js/158.242ba411.js"><link rel="prefetch" href="/assets/js/159.136ff0a3.js"><link rel="prefetch" href="/assets/js/16.ed7e507f.js"><link rel="prefetch" href="/assets/js/160.25dcaecf.js"><link rel="prefetch" href="/assets/js/161.ab904d4e.js"><link rel="prefetch" href="/assets/js/162.04b69881.js"><link rel="prefetch" href="/assets/js/163.e7e749f8.js"><link rel="prefetch" href="/assets/js/164.71f53227.js"><link rel="prefetch" href="/assets/js/165.5841cd1a.js"><link rel="prefetch" href="/assets/js/166.28071d6e.js"><link rel="prefetch" href="/assets/js/167.93ce97d2.js"><link rel="prefetch" href="/assets/js/168.f3b2972c.js"><link rel="prefetch" href="/assets/js/169.aa7f77f0.js"><link rel="prefetch" href="/assets/js/17.de667ca5.js"><link rel="prefetch" href="/assets/js/170.cfdf36f3.js"><link rel="prefetch" href="/assets/js/171.e542ad9a.js"><link rel="prefetch" href="/assets/js/172.2101f9ed.js"><link rel="prefetch" href="/assets/js/173.8f875d74.js"><link rel="prefetch" href="/assets/js/174.61572c8b.js"><link rel="prefetch" href="/assets/js/175.2ce966d7.js"><link rel="prefetch" href="/assets/js/176.bf7661ff.js"><link rel="prefetch" href="/assets/js/177.99ab75ff.js"><link rel="prefetch" href="/assets/js/178.8c053eff.js"><link rel="prefetch" href="/assets/js/179.bb56672f.js"><link rel="prefetch" href="/assets/js/18.b44e84af.js"><link rel="prefetch" href="/assets/js/180.44be886d.js"><link rel="prefetch" href="/assets/js/181.a635f8b4.js"><link rel="prefetch" href="/assets/js/182.43ee494e.js"><link rel="prefetch" href="/assets/js/183.7f8013e7.js"><link rel="prefetch" href="/assets/js/184.995eba6d.js"><link rel="prefetch" href="/assets/js/185.ae8dc8fc.js"><link rel="prefetch" href="/assets/js/186.f5f3b8d8.js"><link rel="prefetch" href="/assets/js/187.0b834066.js"><link rel="prefetch" href="/assets/js/188.de0798b4.js"><link rel="prefetch" href="/assets/js/189.bd73bd48.js"><link rel="prefetch" href="/assets/js/19.5b5ad6a1.js"><link rel="prefetch" href="/assets/js/190.3b34618c.js"><link rel="prefetch" href="/assets/js/191.d69ac5ae.js"><link rel="prefetch" href="/assets/js/192.6fb41323.js"><link rel="prefetch" href="/assets/js/193.deec3471.js"><link rel="prefetch" href="/assets/js/194.a936f543.js"><link rel="prefetch" href="/assets/js/195.257a9d86.js"><link rel="prefetch" href="/assets/js/196.b04a1424.js"><link rel="prefetch" href="/assets/js/197.b1b12256.js"><link rel="prefetch" href="/assets/js/198.d3539378.js"><link rel="prefetch" href="/assets/js/199.802facc3.js"><link rel="prefetch" href="/assets/js/20.6800493a.js"><link rel="prefetch" href="/assets/js/200.c2e3da4f.js"><link rel="prefetch" href="/assets/js/201.9b119f49.js"><link rel="prefetch" href="/assets/js/202.283e51cb.js"><link rel="prefetch" href="/assets/js/203.4ebeba02.js"><link rel="prefetch" href="/assets/js/204.a3680104.js"><link rel="prefetch" href="/assets/js/205.e89e1221.js"><link rel="prefetch" href="/assets/js/206.a2159b40.js"><link rel="prefetch" href="/assets/js/207.30aa8a56.js"><link rel="prefetch" href="/assets/js/208.25e87523.js"><link rel="prefetch" href="/assets/js/209.1feb11d6.js"><link rel="prefetch" href="/assets/js/21.6589052c.js"><link rel="prefetch" href="/assets/js/210.3988d49f.js"><link rel="prefetch" href="/assets/js/211.c35b6127.js"><link rel="prefetch" href="/assets/js/212.a47a605d.js"><link rel="prefetch" href="/assets/js/213.e67c2145.js"><link rel="prefetch" href="/assets/js/214.f2adf5ee.js"><link rel="prefetch" href="/assets/js/215.8af7fa44.js"><link rel="prefetch" href="/assets/js/216.c4c02e18.js"><link rel="prefetch" href="/assets/js/217.8a2ed0a4.js"><link rel="prefetch" href="/assets/js/218.5224a21c.js"><link rel="prefetch" href="/assets/js/219.85a23ded.js"><link rel="prefetch" href="/assets/js/22.f648d829.js"><link rel="prefetch" href="/assets/js/220.1a4b37cb.js"><link rel="prefetch" href="/assets/js/221.fd8b42a5.js"><link rel="prefetch" href="/assets/js/222.ab3b9c2e.js"><link rel="prefetch" href="/assets/js/223.7e579d8f.js"><link rel="prefetch" href="/assets/js/224.a9ba827c.js"><link rel="prefetch" href="/assets/js/225.e1612fcc.js"><link rel="prefetch" href="/assets/js/226.9c1af133.js"><link rel="prefetch" href="/assets/js/227.0bc3b51e.js"><link rel="prefetch" href="/assets/js/228.a0eba8af.js"><link rel="prefetch" href="/assets/js/229.5d1c84bb.js"><link rel="prefetch" href="/assets/js/23.79aa69fa.js"><link rel="prefetch" href="/assets/js/230.f83fdc59.js"><link rel="prefetch" href="/assets/js/231.9f82cedb.js"><link rel="prefetch" href="/assets/js/232.f97914ee.js"><link rel="prefetch" href="/assets/js/233.50ac2baa.js"><link rel="prefetch" href="/assets/js/234.d313f866.js"><link rel="prefetch" href="/assets/js/235.f5eb3748.js"><link rel="prefetch" href="/assets/js/236.d452db47.js"><link rel="prefetch" href="/assets/js/237.5199378b.js"><link rel="prefetch" href="/assets/js/238.d1c3107c.js"><link rel="prefetch" href="/assets/js/239.4e2b6d59.js"><link rel="prefetch" href="/assets/js/24.03ffbcca.js"><link rel="prefetch" href="/assets/js/240.b46f5ecd.js"><link rel="prefetch" href="/assets/js/241.7e9311b0.js"><link rel="prefetch" href="/assets/js/242.ede280f9.js"><link rel="prefetch" href="/assets/js/243.71efdf6e.js"><link rel="prefetch" href="/assets/js/244.1b089d77.js"><link rel="prefetch" href="/assets/js/245.47562a1b.js"><link rel="prefetch" href="/assets/js/246.35ce7ccb.js"><link rel="prefetch" href="/assets/js/247.0eea6dda.js"><link rel="prefetch" href="/assets/js/248.d606d51a.js"><link rel="prefetch" href="/assets/js/249.22a9c555.js"><link rel="prefetch" href="/assets/js/25.872464d2.js"><link rel="prefetch" href="/assets/js/250.7cf64a15.js"><link rel="prefetch" href="/assets/js/251.b6f787d7.js"><link rel="prefetch" href="/assets/js/252.8b9bedcd.js"><link rel="prefetch" href="/assets/js/253.5c63ec35.js"><link rel="prefetch" href="/assets/js/254.31ff9dc4.js"><link rel="prefetch" href="/assets/js/255.190e5f80.js"><link rel="prefetch" href="/assets/js/256.e68f87e0.js"><link rel="prefetch" href="/assets/js/257.3095f7a1.js"><link rel="prefetch" href="/assets/js/258.af517699.js"><link rel="prefetch" href="/assets/js/259.f10ece0f.js"><link rel="prefetch" href="/assets/js/26.bd6d2ac2.js"><link rel="prefetch" href="/assets/js/260.e8bbba00.js"><link rel="prefetch" href="/assets/js/261.5d9b1d5e.js"><link rel="prefetch" href="/assets/js/262.950474a9.js"><link rel="prefetch" href="/assets/js/263.3e7dca65.js"><link rel="prefetch" href="/assets/js/264.1017ad1a.js"><link rel="prefetch" href="/assets/js/265.99c4d846.js"><link rel="prefetch" href="/assets/js/266.8d1ea647.js"><link rel="prefetch" href="/assets/js/267.20e69579.js"><link rel="prefetch" href="/assets/js/268.4da84374.js"><link rel="prefetch" href="/assets/js/269.e3ad7859.js"><link rel="prefetch" href="/assets/js/27.814c713d.js"><link rel="prefetch" href="/assets/js/270.c5c4b40b.js"><link rel="prefetch" href="/assets/js/271.9c7294fd.js"><link rel="prefetch" href="/assets/js/272.3d41fdce.js"><link rel="prefetch" href="/assets/js/273.3eaafe8e.js"><link rel="prefetch" href="/assets/js/274.f98d5554.js"><link rel="prefetch" href="/assets/js/275.5ec6a4b8.js"><link rel="prefetch" href="/assets/js/276.0936dd89.js"><link rel="prefetch" href="/assets/js/277.33bd4dff.js"><link rel="prefetch" href="/assets/js/278.c383b31c.js"><link rel="prefetch" href="/assets/js/279.6df8b215.js"><link rel="prefetch" href="/assets/js/28.5229eb08.js"><link rel="prefetch" href="/assets/js/280.07169fc6.js"><link rel="prefetch" href="/assets/js/281.4b28be3f.js"><link rel="prefetch" href="/assets/js/282.79bba86e.js"><link rel="prefetch" href="/assets/js/283.32f592bc.js"><link rel="prefetch" href="/assets/js/284.fd9b6b59.js"><link rel="prefetch" href="/assets/js/285.df1454be.js"><link rel="prefetch" href="/assets/js/286.18b1703e.js"><link rel="prefetch" href="/assets/js/287.94781ca0.js"><link rel="prefetch" href="/assets/js/288.f21493cb.js"><link rel="prefetch" href="/assets/js/289.8fc283e3.js"><link rel="prefetch" href="/assets/js/29.a63c1057.js"><link rel="prefetch" href="/assets/js/290.3346a986.js"><link rel="prefetch" href="/assets/js/291.5fafa49e.js"><link rel="prefetch" href="/assets/js/292.ac874de4.js"><link rel="prefetch" href="/assets/js/293.19730c32.js"><link rel="prefetch" href="/assets/js/294.98ddc6d7.js"><link rel="prefetch" href="/assets/js/295.eae00758.js"><link rel="prefetch" href="/assets/js/296.1d81c552.js"><link rel="prefetch" href="/assets/js/297.5f86f97e.js"><link rel="prefetch" href="/assets/js/298.1bc558ca.js"><link rel="prefetch" href="/assets/js/299.d068c6b6.js"><link rel="prefetch" href="/assets/js/3.13e892f5.js"><link rel="prefetch" href="/assets/js/30.1b884b1b.js"><link rel="prefetch" href="/assets/js/300.c956e204.js"><link rel="prefetch" href="/assets/js/301.77127d95.js"><link rel="prefetch" href="/assets/js/302.1d7c4af3.js"><link rel="prefetch" href="/assets/js/303.2bcbc099.js"><link rel="prefetch" href="/assets/js/304.b2180761.js"><link rel="prefetch" href="/assets/js/305.3ac4a62e.js"><link rel="prefetch" href="/assets/js/306.1ce3e68d.js"><link rel="prefetch" href="/assets/js/307.6c3d9548.js"><link rel="prefetch" href="/assets/js/308.b777fbfa.js"><link rel="prefetch" href="/assets/js/309.e5d32660.js"><link rel="prefetch" href="/assets/js/31.68c1b4eb.js"><link rel="prefetch" href="/assets/js/310.fcda8acc.js"><link rel="prefetch" href="/assets/js/311.cde4dc35.js"><link rel="prefetch" href="/assets/js/312.98a0ee89.js"><link rel="prefetch" href="/assets/js/313.ce02630f.js"><link rel="prefetch" href="/assets/js/314.3883ac39.js"><link rel="prefetch" href="/assets/js/315.b6c9cd37.js"><link rel="prefetch" href="/assets/js/316.6cd33ea7.js"><link rel="prefetch" href="/assets/js/317.eb818350.js"><link rel="prefetch" href="/assets/js/318.e9e7da16.js"><link rel="prefetch" href="/assets/js/319.1edfec0a.js"><link rel="prefetch" href="/assets/js/32.64224241.js"><link rel="prefetch" href="/assets/js/320.f4728475.js"><link rel="prefetch" href="/assets/js/321.799c6e59.js"><link rel="prefetch" href="/assets/js/322.a701407b.js"><link rel="prefetch" href="/assets/js/323.803b7bcc.js"><link rel="prefetch" href="/assets/js/324.a73b88d8.js"><link rel="prefetch" href="/assets/js/325.f08e06ca.js"><link rel="prefetch" href="/assets/js/326.80813d35.js"><link rel="prefetch" href="/assets/js/327.8310d6c8.js"><link rel="prefetch" href="/assets/js/328.68f1b07a.js"><link rel="prefetch" href="/assets/js/329.04be32fe.js"><link rel="prefetch" href="/assets/js/33.b4859866.js"><link rel="prefetch" href="/assets/js/330.fbd486d3.js"><link rel="prefetch" href="/assets/js/331.bc43b814.js"><link rel="prefetch" href="/assets/js/332.838514e5.js"><link rel="prefetch" href="/assets/js/333.c647f10b.js"><link rel="prefetch" href="/assets/js/334.293d7db1.js"><link rel="prefetch" href="/assets/js/335.f60f98c5.js"><link rel="prefetch" href="/assets/js/336.d59a627e.js"><link rel="prefetch" href="/assets/js/337.719cd005.js"><link rel="prefetch" href="/assets/js/338.eb93d4b7.js"><link rel="prefetch" href="/assets/js/339.a38c5695.js"><link rel="prefetch" href="/assets/js/34.69c1bc55.js"><link rel="prefetch" href="/assets/js/340.9a4ce427.js"><link rel="prefetch" href="/assets/js/341.d39b4f2f.js"><link rel="prefetch" href="/assets/js/342.11fbba88.js"><link rel="prefetch" href="/assets/js/343.36030f9c.js"><link rel="prefetch" href="/assets/js/344.94fc0ac0.js"><link rel="prefetch" href="/assets/js/345.c6ef0cd3.js"><link rel="prefetch" href="/assets/js/346.3f3484bf.js"><link rel="prefetch" href="/assets/js/347.f6957922.js"><link rel="prefetch" href="/assets/js/348.df8650b3.js"><link rel="prefetch" href="/assets/js/349.402ca2e1.js"><link rel="prefetch" href="/assets/js/35.d8b00796.js"><link rel="prefetch" href="/assets/js/350.8a48f4c3.js"><link rel="prefetch" href="/assets/js/351.b5356e83.js"><link rel="prefetch" href="/assets/js/352.944301fd.js"><link rel="prefetch" href="/assets/js/353.8b170c06.js"><link rel="prefetch" href="/assets/js/354.97b92290.js"><link rel="prefetch" href="/assets/js/355.948e7095.js"><link rel="prefetch" href="/assets/js/356.5aaf9fe5.js"><link rel="prefetch" href="/assets/js/357.67c88167.js"><link rel="prefetch" href="/assets/js/358.e241fbe2.js"><link rel="prefetch" href="/assets/js/359.15b3166a.js"><link rel="prefetch" href="/assets/js/36.090e85b2.js"><link rel="prefetch" href="/assets/js/360.187f4fe6.js"><link rel="prefetch" href="/assets/js/361.a77fa57f.js"><link rel="prefetch" href="/assets/js/362.30ed8657.js"><link rel="prefetch" href="/assets/js/363.c8caaf0f.js"><link rel="prefetch" href="/assets/js/364.78f41e2e.js"><link rel="prefetch" href="/assets/js/365.55b8d5b3.js"><link rel="prefetch" href="/assets/js/366.d1c007ca.js"><link rel="prefetch" href="/assets/js/367.bc6a31fb.js"><link rel="prefetch" href="/assets/js/368.147012d3.js"><link rel="prefetch" href="/assets/js/369.94f25d03.js"><link rel="prefetch" href="/assets/js/37.bf92df67.js"><link rel="prefetch" href="/assets/js/370.37c8786f.js"><link rel="prefetch" href="/assets/js/371.037e513b.js"><link rel="prefetch" href="/assets/js/372.353d4826.js"><link rel="prefetch" href="/assets/js/373.3260442b.js"><link rel="prefetch" href="/assets/js/374.eabaedd4.js"><link rel="prefetch" href="/assets/js/375.f80e9c75.js"><link rel="prefetch" href="/assets/js/376.b041cafe.js"><link rel="prefetch" href="/assets/js/377.d6410416.js"><link rel="prefetch" href="/assets/js/378.0d21f78f.js"><link rel="prefetch" href="/assets/js/379.83c05c56.js"><link rel="prefetch" href="/assets/js/38.74932844.js"><link rel="prefetch" href="/assets/js/380.c41e1704.js"><link rel="prefetch" href="/assets/js/381.52c6dcbf.js"><link rel="prefetch" href="/assets/js/382.d2998ea4.js"><link rel="prefetch" href="/assets/js/383.160918fa.js"><link rel="prefetch" href="/assets/js/384.6e3e4604.js"><link rel="prefetch" href="/assets/js/385.e514c0b7.js"><link rel="prefetch" href="/assets/js/386.3cab7b43.js"><link rel="prefetch" href="/assets/js/387.7b7aa4c3.js"><link rel="prefetch" href="/assets/js/388.1675a9c8.js"><link rel="prefetch" href="/assets/js/389.f5e5e9e4.js"><link rel="prefetch" href="/assets/js/39.45a654d9.js"><link rel="prefetch" href="/assets/js/390.5bbca72c.js"><link rel="prefetch" href="/assets/js/391.4e95a939.js"><link rel="prefetch" href="/assets/js/392.8eb7d12f.js"><link rel="prefetch" href="/assets/js/393.f72f9473.js"><link rel="prefetch" href="/assets/js/394.1cea58b3.js"><link rel="prefetch" href="/assets/js/395.33fa0847.js"><link rel="prefetch" href="/assets/js/396.8ef17642.js"><link rel="prefetch" href="/assets/js/397.dd02eee1.js"><link rel="prefetch" href="/assets/js/398.23ea33a3.js"><link rel="prefetch" href="/assets/js/399.84a4e8db.js"><link rel="prefetch" href="/assets/js/4.5bdb9365.js"><link rel="prefetch" href="/assets/js/40.7cc37d90.js"><link rel="prefetch" href="/assets/js/400.0597181f.js"><link rel="prefetch" href="/assets/js/401.9cb4c0e2.js"><link rel="prefetch" href="/assets/js/402.41ddf5c4.js"><link rel="prefetch" href="/assets/js/403.afa305eb.js"><link rel="prefetch" href="/assets/js/404.3831ec8d.js"><link rel="prefetch" href="/assets/js/405.b79a51fb.js"><link rel="prefetch" href="/assets/js/406.dd6191a5.js"><link rel="prefetch" href="/assets/js/407.d2e12f04.js"><link rel="prefetch" href="/assets/js/408.56c2fc48.js"><link rel="prefetch" href="/assets/js/409.25a15725.js"><link rel="prefetch" href="/assets/js/41.78331f9e.js"><link rel="prefetch" href="/assets/js/410.dd6c1352.js"><link rel="prefetch" href="/assets/js/411.6d95d902.js"><link rel="prefetch" href="/assets/js/412.da6546bd.js"><link rel="prefetch" href="/assets/js/413.39d34e64.js"><link rel="prefetch" href="/assets/js/414.aaa215f3.js"><link rel="prefetch" href="/assets/js/415.b41c61b6.js"><link rel="prefetch" href="/assets/js/416.139592a7.js"><link rel="prefetch" href="/assets/js/417.324a89a1.js"><link rel="prefetch" href="/assets/js/418.676f7dcb.js"><link rel="prefetch" href="/assets/js/419.9350419c.js"><link rel="prefetch" href="/assets/js/42.a22391d6.js"><link rel="prefetch" href="/assets/js/420.0462f81e.js"><link rel="prefetch" href="/assets/js/421.a6efdd34.js"><link rel="prefetch" href="/assets/js/422.569428e8.js"><link rel="prefetch" href="/assets/js/423.8cb41fe5.js"><link rel="prefetch" href="/assets/js/424.98a9d128.js"><link rel="prefetch" href="/assets/js/425.62b51cfb.js"><link rel="prefetch" href="/assets/js/426.7b3a49e4.js"><link rel="prefetch" href="/assets/js/427.f99d9c10.js"><link rel="prefetch" href="/assets/js/428.73db8fe6.js"><link rel="prefetch" href="/assets/js/429.05f1741b.js"><link rel="prefetch" href="/assets/js/43.8946d7e2.js"><link rel="prefetch" href="/assets/js/430.8b43f070.js"><link rel="prefetch" href="/assets/js/431.d85a79d6.js"><link rel="prefetch" href="/assets/js/432.7373e34b.js"><link rel="prefetch" href="/assets/js/433.4be17add.js"><link rel="prefetch" href="/assets/js/434.81670bcf.js"><link rel="prefetch" href="/assets/js/435.6aa95ea5.js"><link rel="prefetch" href="/assets/js/436.4223c356.js"><link rel="prefetch" href="/assets/js/437.13f276dc.js"><link rel="prefetch" href="/assets/js/438.7c6e503d.js"><link rel="prefetch" href="/assets/js/439.6f9afc22.js"><link rel="prefetch" href="/assets/js/44.2a678f4a.js"><link rel="prefetch" href="/assets/js/440.5c949914.js"><link rel="prefetch" href="/assets/js/441.7dc7c8e4.js"><link rel="prefetch" href="/assets/js/442.bfec8250.js"><link rel="prefetch" href="/assets/js/443.0b932152.js"><link rel="prefetch" href="/assets/js/444.ecc56127.js"><link rel="prefetch" href="/assets/js/445.3a1eefa1.js"><link rel="prefetch" href="/assets/js/446.07410371.js"><link rel="prefetch" href="/assets/js/447.920996c3.js"><link rel="prefetch" href="/assets/js/448.9b5b5588.js"><link rel="prefetch" href="/assets/js/449.40afb76e.js"><link rel="prefetch" href="/assets/js/45.a716cdab.js"><link rel="prefetch" href="/assets/js/450.15845e93.js"><link rel="prefetch" href="/assets/js/451.c0454122.js"><link rel="prefetch" href="/assets/js/452.076ca38b.js"><link rel="prefetch" href="/assets/js/453.35add2cd.js"><link rel="prefetch" href="/assets/js/454.fed25dd2.js"><link rel="prefetch" href="/assets/js/455.a3232b7e.js"><link rel="prefetch" href="/assets/js/456.803d9cea.js"><link rel="prefetch" href="/assets/js/457.0a884768.js"><link rel="prefetch" href="/assets/js/458.69b6cc02.js"><link rel="prefetch" href="/assets/js/459.d8e1df18.js"><link rel="prefetch" href="/assets/js/46.53b78a16.js"><link rel="prefetch" href="/assets/js/460.a4980d6e.js"><link rel="prefetch" href="/assets/js/461.68d3e1c1.js"><link rel="prefetch" href="/assets/js/462.7930ea12.js"><link rel="prefetch" href="/assets/js/463.48a62ed8.js"><link rel="prefetch" href="/assets/js/464.5c42fe51.js"><link rel="prefetch" href="/assets/js/465.b65a0e95.js"><link rel="prefetch" href="/assets/js/466.63474609.js"><link rel="prefetch" href="/assets/js/467.e6370736.js"><link rel="prefetch" href="/assets/js/468.a6cd9285.js"><link rel="prefetch" href="/assets/js/469.3df61389.js"><link rel="prefetch" href="/assets/js/47.dc9468b3.js"><link rel="prefetch" href="/assets/js/470.b956e72b.js"><link rel="prefetch" href="/assets/js/471.227fb33d.js"><link rel="prefetch" href="/assets/js/472.407485a3.js"><link rel="prefetch" href="/assets/js/473.9ab2c50d.js"><link rel="prefetch" href="/assets/js/474.dd36f932.js"><link rel="prefetch" href="/assets/js/475.7634085c.js"><link rel="prefetch" href="/assets/js/476.6869c979.js"><link rel="prefetch" href="/assets/js/477.b8bbd1aa.js"><link rel="prefetch" href="/assets/js/478.d85549c5.js"><link rel="prefetch" href="/assets/js/479.a549954b.js"><link rel="prefetch" href="/assets/js/48.f62c6508.js"><link rel="prefetch" href="/assets/js/480.964f2b40.js"><link rel="prefetch" href="/assets/js/481.68f5f905.js"><link rel="prefetch" href="/assets/js/482.32b674c2.js"><link rel="prefetch" href="/assets/js/483.6574c15d.js"><link rel="prefetch" href="/assets/js/484.63db4bff.js"><link rel="prefetch" href="/assets/js/485.0ecd7c6e.js"><link rel="prefetch" href="/assets/js/486.44a1de5d.js"><link rel="prefetch" href="/assets/js/487.fad12e99.js"><link rel="prefetch" href="/assets/js/488.169f32db.js"><link rel="prefetch" href="/assets/js/489.7ea816a6.js"><link rel="prefetch" href="/assets/js/49.f155d78a.js"><link rel="prefetch" href="/assets/js/490.d35de876.js"><link rel="prefetch" href="/assets/js/491.08874d90.js"><link rel="prefetch" href="/assets/js/493.61d62bf4.js"><link rel="prefetch" href="/assets/js/494.b0515138.js"><link rel="prefetch" href="/assets/js/495.60587f26.js"><link rel="prefetch" href="/assets/js/496.d66df398.js"><link rel="prefetch" href="/assets/js/497.7c88f879.js"><link rel="prefetch" href="/assets/js/498.73e1e0cf.js"><link rel="prefetch" href="/assets/js/499.8162e0b6.js"><link rel="prefetch" href="/assets/js/5.7c68fdb5.js"><link rel="prefetch" href="/assets/js/50.d2b62498.js"><link rel="prefetch" href="/assets/js/500.8b0de440.js"><link rel="prefetch" href="/assets/js/501.0894844d.js"><link rel="prefetch" href="/assets/js/502.1c0d1c3c.js"><link rel="prefetch" href="/assets/js/503.3e3f2a4a.js"><link rel="prefetch" href="/assets/js/504.cca812a4.js"><link rel="prefetch" href="/assets/js/505.8a1f3adc.js"><link rel="prefetch" href="/assets/js/506.35d49763.js"><link rel="prefetch" href="/assets/js/507.4fd3c268.js"><link rel="prefetch" href="/assets/js/508.aa2ba78c.js"><link rel="prefetch" href="/assets/js/509.cc7d97eb.js"><link rel="prefetch" href="/assets/js/51.7b12b0f0.js"><link rel="prefetch" href="/assets/js/510.73e3254c.js"><link rel="prefetch" href="/assets/js/511.bd21926b.js"><link rel="prefetch" href="/assets/js/512.8b796161.js"><link rel="prefetch" href="/assets/js/513.da11e0bf.js"><link rel="prefetch" href="/assets/js/514.5a620685.js"><link rel="prefetch" href="/assets/js/515.9a4b1681.js"><link rel="prefetch" href="/assets/js/516.de55e3ca.js"><link rel="prefetch" href="/assets/js/517.2b3b1dd5.js"><link rel="prefetch" href="/assets/js/518.aa28e969.js"><link rel="prefetch" href="/assets/js/519.91a752a1.js"><link rel="prefetch" href="/assets/js/52.3391993d.js"><link rel="prefetch" href="/assets/js/520.49c84d3e.js"><link rel="prefetch" href="/assets/js/521.545008de.js"><link rel="prefetch" href="/assets/js/522.11773c74.js"><link rel="prefetch" href="/assets/js/523.5b523166.js"><link rel="prefetch" href="/assets/js/524.9d7c8f5c.js"><link rel="prefetch" href="/assets/js/53.a67a7068.js"><link rel="prefetch" href="/assets/js/54.af0dccf3.js"><link rel="prefetch" href="/assets/js/55.cdae5880.js"><link rel="prefetch" href="/assets/js/56.4d918bef.js"><link rel="prefetch" href="/assets/js/57.5e9dea12.js"><link rel="prefetch" href="/assets/js/58.6cec08ff.js"><link rel="prefetch" href="/assets/js/59.65771179.js"><link rel="prefetch" href="/assets/js/6.c8da7ca7.js"><link rel="prefetch" href="/assets/js/60.8f859a65.js"><link rel="prefetch" href="/assets/js/61.43bff54c.js"><link rel="prefetch" href="/assets/js/62.b8e9e509.js"><link rel="prefetch" href="/assets/js/63.5149a7b9.js"><link rel="prefetch" href="/assets/js/64.961c386a.js"><link rel="prefetch" href="/assets/js/65.73f66baf.js"><link rel="prefetch" href="/assets/js/66.b5930577.js"><link rel="prefetch" href="/assets/js/67.40a0db0c.js"><link rel="prefetch" href="/assets/js/68.6212d2a9.js"><link rel="prefetch" href="/assets/js/69.0cd6b5c4.js"><link rel="prefetch" href="/assets/js/7.e4c88d0e.js"><link rel="prefetch" href="/assets/js/70.8e1f3dad.js"><link rel="prefetch" href="/assets/js/71.041fa5d5.js"><link rel="prefetch" href="/assets/js/72.7b626c12.js"><link rel="prefetch" href="/assets/js/73.78b38a87.js"><link rel="prefetch" href="/assets/js/74.6ec158a9.js"><link rel="prefetch" href="/assets/js/75.de5261fd.js"><link rel="prefetch" href="/assets/js/76.49878016.js"><link rel="prefetch" href="/assets/js/77.77eb5ec0.js"><link rel="prefetch" href="/assets/js/78.13279776.js"><link rel="prefetch" href="/assets/js/79.55cd4da6.js"><link rel="prefetch" href="/assets/js/80.2d4e5531.js"><link rel="prefetch" href="/assets/js/81.f00c64f4.js"><link rel="prefetch" href="/assets/js/82.af834374.js"><link rel="prefetch" href="/assets/js/83.42d97060.js"><link rel="prefetch" href="/assets/js/84.e6bc84a7.js"><link rel="prefetch" href="/assets/js/85.beeccec9.js"><link rel="prefetch" href="/assets/js/86.af675949.js"><link rel="prefetch" href="/assets/js/87.42f1b392.js"><link rel="prefetch" href="/assets/js/88.b5b8b77f.js"><link rel="prefetch" href="/assets/js/89.5892cf98.js"><link rel="prefetch" href="/assets/js/90.975b2533.js"><link rel="prefetch" href="/assets/js/91.64ccb26a.js"><link rel="prefetch" href="/assets/js/92.159aca5a.js"><link rel="prefetch" href="/assets/js/93.ca72cfb7.js"><link rel="prefetch" href="/assets/js/94.134a585d.js"><link rel="prefetch" href="/assets/js/95.83f34609.js"><link rel="prefetch" href="/assets/js/96.25383af1.js"><link rel="prefetch" href="/assets/js/97.404579a5.js"><link rel="prefetch" href="/assets/js/98.b15c1a8c.js"><link rel="prefetch" href="/assets/js/99.2757d9cd.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5143d2e0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4a844ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端收集</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><a href="/react-source/" class="nav-link">
  源码解析
</a></div><div class="nav-item"><a href="/mdn/" class="nav-link">
  MDN
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  JS进阶
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/deploy/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/qa/" class="nav-link">
  QA
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="链接" class="dropdown-title"><span class="title">链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="链接" class="mobile-dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://note.aduang.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  note
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/chnduang/cv-collect-blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><a href="/react-source/" class="nav-link">
  源码解析
</a></div><div class="nav-item"><a href="/mdn/" class="nav-link">
  MDN
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  JS进阶
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/deploy/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/qa/" class="nav-link">
  QA
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="链接" class="dropdown-title"><span class="title">链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="链接" class="mobile-dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://note.aduang.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  note
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/chnduang/cv-collect-blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/react/" aria-current="page" class="sidebar-link">目录</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/1-基础部分" class="sidebar-heading clickable"><span>基础部分</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/2-进阶" class="sidebar-heading clickable"><span>进阶</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/3-hooks" class="sidebar-heading clickable"><span>hooks</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/4-事件机制" class="sidebar-heading clickable open"><span>事件机制</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/4-%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/react/4-事件机制/React事件机制.html" class="sidebar-link">React 事件机制</a></li><li><a href="/react/4-事件机制/Render如何强制它.html" class="sidebar-link">什么是 React 中的 Render 以及如何强制它？</a></li><li><a href="/react/4-事件机制/react-事件机制.html" class="sidebar-link">React事件机制的理解？</a></li><li><a href="/react/4-事件机制/react事件系统原理.html" class="sidebar-link">React 事件系统原理</a></li><li><a href="/react/4-事件机制/一文吃透react事件原理.html" class="active sidebar-link">一文吃透react事件原理</a></li><li><a href="/react/4-事件机制/一文读懂React组件渲染核心原理.html" class="sidebar-link">一文读懂 React 组件渲染核心原理</a></li><li><a href="/react/4-事件机制/从源码深入探究React运行时优化方案的演进.html" class="sidebar-link">从源码深入探究React 运行时优化方案的演进</a></li><li><a href="/react/4-事件机制/搞懂React调度器原理.html" class="sidebar-link">不用一行代码，搞懂React调度器原理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/5-fiber" class="sidebar-heading clickable"><span>fiber</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/7-性能优化" class="sidebar-heading clickable"><span>性能优化</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/8-SSR" class="sidebar-heading clickable"><span>SSR</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/8-单元测试" class="sidebar-heading clickable"><span>单元测试</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="一文吃透react事件原理"><a href="#一文吃透react事件原理" class="header-anchor">#</a> 一文吃透react事件原理</h1> <blockquote><p><a href="https://mp.weixin.qq.com/s/LvzC74rlYZr4tSkFkxGAoA" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/LvzC74rlYZr4tSkFkxGAoA<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h1 id="一-前言"><a href="#一-前言" class="header-anchor">#</a> 一 前言</h1> <p>今天我们来一起探讨一下<code>React</code>事件原理，这篇文章，我尽量用通俗简洁的方式，把<code>React</code>事件系统讲的明明白白。</p> <p>我们讲的<code>react</code>版本是<code>16.13.1</code> , <code>v17</code>之后<code>react</code>对于事件系统会有相关的改版，文章后半部分会提及。</p> <p>老规矩，在正式讲解<code>react</code>之前，我们先想想这几个问题(<strong>如果我是面试官，你会怎么回答?</strong>)：</p> <ul><li>1 我们写的事件是绑定在<code>dom</code>上么，如果不是绑定在哪里？</li> <li>2 为什么我们的事件不能绑定给组件？</li> <li>3 为什么我们的事件手动绑定<code>this</code>(不是箭头函数的情况)</li> <li>4 为什么不能用 <code>return false</code>来阻止事件的默认行为？</li> <li>5 <code>react</code>怎么通过<code>dom</code>元素，找到与之对应的 <code>fiber</code>对象的？</li> <li>6 <code>onClick</code>是在冒泡阶段绑定的？那么<code>onClickCapture</code>就是在事件捕获阶段绑定的吗？</li></ul> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdzYHmxW0oy7mdIaqtmicIXNJvIa01mAsTNF4mZMy2fsSWicp4VEsdj7xeRuScjTEQHibLayphqpySHcA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">B7836791-2C40-48BA-83BF-835E0BD87B55.jpg</p> <h2 id="必要的知识概念"><a href="#必要的知识概念" class="header-anchor">#</a> 必要的知识概念</h2> <p>在弄清楚<code>react</code>事件之前，有几个概念我们必须弄清楚，因为只有弄明白这几个概念，在事件触发阶段，我们才能更好的理解<code>react</code>处理事件本质。</p> <h3 id="我们写在jsx事件终将变成什么"><a href="#我们写在jsx事件终将变成什么" class="header-anchor">#</a> 我们写在JSX事件终将变成什么？</h3> <p>我们先写一段含有点击事件的<code>react JSX</code>语法，看一下它最终会变成什么样子？</p> <div class="language- extra-class"><pre class="language-text"><code>class Index extends React.Component{
    handerClick= (value) =&gt; console.log(value) 
    render(){
        return &lt;div&gt;
            &lt;button onClick={ this.handerClick } &gt; 按钮点击 &lt;/button&gt;
        &lt;/div&gt;
    }
}
</code></pre></div><p>经过<code>babel</code>转换成<code>React.createElement</code>形式，如下：</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdzYHmxW0oy7mdIaqtmicIXNJJahUR1Z33lpxmZbZib4mK2DRicjlHgbOKsyK3bLUkFrWENflaAlEYYMw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">babel.jpg</p> <p>最终转成<code>fiber</code>对象形式如下：</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdzYHmxW0oy7mdIaqtmicIXNJJcMr48au9dvwHUoH3ffJoOafWib1iccEYTia9ACgl4oicV5nymeElxSlIw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">fiber.jpg</p> <p><code>fiber</code>对象上的<code>memoizedProps</code> 和 <code>pendingProps</code>保存了我们的事件。</p> <h3 id="什么是合成事件"><a href="#什么是合成事件" class="header-anchor">#</a> 什么是合成事件？</h3> <p>通过上一步我们看到了，我们声明事件保存的位置。但是事件有没有被真正的注册呢？我们接下来看一下：</p> <p>我们看一下当前这个元素<code>&lt;button&gt;</code>上有没有绑定这个事件监听器呢？</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdzYHmxW0oy7mdIaqtmicIXNJQMsySfXz8S6wKO34YK5wklp5RDib95E2u3eWX1ujVqzwD8x0ZWicsZpw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">button_event.jpg</p> <p><strong>button上绑定的事件</strong></p> <p>我们可以看到 ，<code>button</code>上绑定了两个事件，一个是<code>document</code>上的事件监听器，另外一个是<code>button</code>，但是事件处理函数<code>handle</code>，并不是我们的<code>handerClick</code>事件，而是<code>noop</code>。</p> <p><code>noop</code>是什么呢？我们接着来看。</p> <p>原来<code>noop</code>就指向一个空函数。</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdzYHmxW0oy7mdIaqtmicIXNJfRAX3qRK8pNpjxOVC6uib66tzOEulItlCSKFicPkBlTyE0d2iauJViaKsQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">noop.jpg</p> <p><strong>然后我们看<code>document</code>绑定的事件</strong></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdzYHmxW0oy7mdIaqtmicIXNJgEhMwxlpKicjWlgJRuxaK5xzHCsbP90Mhl3yNuQewwJpKdGbicZjyPqQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">document.jpg</p> <p>可以看到<code>click</code>事件被绑定在<code>document</code>上了。</p> <p>接下来我们再搞搞事情😂😂😂，在<code>demo</code>项目中加上一个<code>input</code>输入框，并绑定一个<code>onChange</code>事件。睁大眼睛看看接下来会发生什么？</p> <div class="language- extra-class"><pre class="language-text"><code>class Index extends React.Component{
    componentDidMount(){
        console.log(this)
    }
    handerClick= (value) =&gt; console.log(value) 
    handerChange=(value) =&gt; console.log(value)
    render(){
        return &lt;div style={{ marginTop:'50px' }} &gt;
            &lt;button onClick={ this.handerClick } &gt; 按钮点击 &lt;/button&gt;
            &lt;input  placeholder=&quot;请输入内容&quot; onChange={ this.handerChange }  /&gt;
        &lt;/div&gt;
    }
}
</code></pre></div><p><strong>我们先看一下<code>input dom</code>元素上绑定的事件</strong></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdzYHmxW0oy7mdIaqtmicIXNJIe7R63IoYxJr2nfeMOuP1aia8DMEjCcGpVQ1rAw4GO3VJ3qNsQ33s8A/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">22BEC470-233A-4C50-9C47-D21D343C055D.jpg</p> <p><strong>然后我们看一下<code>document</code>上绑定的事件</strong></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdzYHmxW0oy7mdIaqtmicIXNJRaNQ4e0F8quv0u0UzSGOfokg9X9wKr0hsDfr3Q8qNgFnGwnXWBmcgA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">8E1D3BDB-ACFB-4E49-A5FF-CF990C47A60E.jpg</p> <p>我们发现，我们给<code>&lt;input&gt;</code>绑定的<code>onChange</code>，并没有直接绑定在<code>input</code>上，而是统一绑定在了<code>document</code>上，然后我们<code>onChange</code>被处理成很多事件监听器，比如<code>blur</code> , <code>change</code> , <code>input</code> , <code>keydown</code> , <code>keyup</code> 等。</p> <p>综上我们可以得出结论：</p> <ul><li>①<strong>我们在 <code>jsx</code> 中绑定的事件(demo中的<code>handerClick</code>，<code>handerChange</code>),根本就没有注册到真实的<code>dom</code>上。是绑定在<code>document</code>上统一管理的。</strong></li> <li>②<strong>真实的<code>dom</code>上的<code>click</code>事件被单独处理,已经被<code>react</code>底层替换成空函数。</strong></li> <li>③<strong>我们在<code>react</code>绑定的事件,比如<code>onChange</code>，在<code>document</code>上，可能有多个事件与之对应。</strong></li> <li>④ <strong><code>react</code>并不是一开始，把所有的事件都绑定在<code>document</code>上，而是采取了一种按需绑定，比如发现了<code>onClick</code>事件,再去绑定<code>document click</code>事件。</strong></li></ul> <p>那么什么是<code>react</code>事件合成呢？</p> <p><strong>在<code>react</code>中，我们绑定的事件<code>onClick</code>等，并不是原生事件，而是由原生事件合成的<code>React</code>事件，比如 <code>click</code>事件合成为<code>onClick</code>事件。比如<code>blur</code> , <code>change</code> , <code>input</code> , <code>keydown</code> , <code>keyup</code>等 , 合成为<code>onChange</code>。</strong></p> <p>那么<code>react</code>采取这种事件合成的模式呢？</p> <p>一方面，将事件绑定在<code>document</code>统一管理，防止很多事件直接绑定在原生的<code>dom</code>元素上。造成一些不可控的情况</p> <p>另一方面， <code>React</code> 想实现一个全浏览器的框架， 为了实现这种目标就需要提供全浏览器一致性的事件系统，以此抹平不同浏览器的差异。</p> <p>接下来的文章中，会介绍<code>react</code>是怎么做事件合成的。</p> <h3 id="dom元素对应的fiber-tag对象"><a href="#dom元素对应的fiber-tag对象" class="header-anchor">#</a> dom元素对应的fiber Tag对象</h3> <p>我们知道了<code>react</code>怎么储存了我们的事件函数和事件合成因果。接下来我想让大家记住一种类型的 <code>fiber</code> 对象,因为后面会用到，这对后续的理解很有帮助。</p> <p>我们先来看一个代码片段：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;div&gt; 
  &lt;div&gt; hello , my name is alien &lt;/div&gt;
&lt;/div&gt;
</code></pre></div><p>看<code>&lt;div&gt; hello , my name is alien &lt;/div&gt;</code> 对应的 <code>fiber</code>类型。tag = 5</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdzYHmxW0oy7mdIaqtmicIXNJsTicvBiajJ0ESuicj1fB0S7UX7C1librMXJiaU5Bwk8g7qLF52MdHujsRmw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">然后我们去<code>react</code>源码中找到这种类的<code>fiber</code>类型。</p> <blockquote><p>/react-reconciler/src/ReactWorkTagsq.js</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>export const HostComponent = 5; // 元素节点
</code></pre></div><p>好的 ，我们暂且把 <code>HostComponent</code> 和 <code>HostText</code>记录📝下来。接下来回归正题，我们先来看看<code>react</code>事件合成机制。</p> <h1 id="二-事件初始化-事件合成-插件机制"><a href="#二-事件初始化-事件合成-插件机制" class="header-anchor">#</a> 二 事件初始化-事件合成，插件机制</h1> <p>接下来，我们来看一看<code>react</code>这么处理事件合成的。首先我们从上面我们知道，<code>react</code>并不是一次性把所有事件都<strong>绑定进去</strong>，而是如果发现项目中有<code>onClick</code>，才绑定<code>click</code>事件，发现有<code>onChange</code>事件，才绑定<code>blur</code> , <code>change</code> , <code>input</code> , <code>keydown</code> , <code>keyup</code>等。所以为了把原理搞的清清楚楚，笔者把事件原理分成三部分来搞定：</p> <ul><li>1 <code>react</code>对事件是如何合成的。</li> <li>2 <code>react</code>事件是怎么绑定的。</li> <li>3 <code>react</code>事件触发流程。</li></ul> <h2 id="事件合成-事件插件"><a href="#事件合成-事件插件" class="header-anchor">#</a> 事件合成-事件插件</h2> <h3 id="_1-必要概念"><a href="#_1-必要概念" class="header-anchor">#</a> 1 必要概念</h3> <p>我们先来看来几个常量关系，这对于我们吃透<code>react</code>事件原理很有帮助。在解析来的讲解中，我也会讲到这几个对象如何来的，具体有什么作用。</p> <h4 id="_1namestoplugins"><a href="#_1namestoplugins" class="header-anchor">#</a> ①namesToPlugins</h4> <p>第一个概念：<strong>namesToPlugins</strong> 装事件名 -&gt; 事件模块插件的映射,<code>namesToPlugins</code>最终的样子如下：</p> <div class="language- extra-class"><pre class="language-text"><code>const namesToPlugins = {
    SimpleEventPlugin,
    EnterLeaveEventPlugin,
    ChangeEventPlugin,
    SelectEventPlugin,
    BeforeInputEventPlugin,
}
</code></pre></div><p><code>SimpleEventPlugin</code>等是处理各个事件函数的插件，比如一次点击事件，就会找到<code>SimpleEventPlugin</code>对应的处理函数。我们先记录下它，至于具体有什么作用，接下来会讲到。</p> <h4 id="_2plugins"><a href="#_2plugins" class="header-anchor">#</a> ②plugins</h4> <p><code>plugins</code>，这个对象就是上面注册的所有插件列表,初始化为空。</p> <div class="language- extra-class"><pre class="language-text"><code>const  plugins = [LegacySimpleEventPlugin, LegacyEnterLeaveEventPlugin, ...];
</code></pre></div><h4 id="_3registrationnamemodules"><a href="#_3registrationnamemodules" class="header-anchor">#</a> ③registrationNameModules</h4> <p><code>registrationNameModules</code>记录了React合成的事件-对应的事件插件的关系，在<code>React</code>中，处理<code>props</code>中事件的时候，会根据不同的事件名称，找到对应的事件插件，然后统一绑定在<code>document</code>上。对于没有出现过的事件，就不会绑定，我们接下来会讲到。<code>registrationNameModules</code>大致的样子如下所示。</p> <div class="language- extra-class"><pre class="language-text"><code>{
    onBlur: SimpleEventPlugin,
    onClick: SimpleEventPlugin,
    onClickCapture: SimpleEventPlugin,
    onChange: ChangeEventPlugin,
    onChangeCapture: ChangeEventPlugin,
    onMouseEnter: EnterLeaveEventPlugin,
    onMouseLeave: EnterLeaveEventPlugin,
    ...
}
</code></pre></div><h4 id="_4事件插件"><a href="#_4事件插件" class="header-anchor">#</a> ④事件插件</h4> <p>那么我们首先就要搞清楚，<code>SimpleEventPlugin</code>,<code>EnterLeaveEventPlugin</code>每个插件都是什么？我们拿<code>SimpleEventPlugin</code>为例，看一下它究竟是什么样子？</p> <div class="language- extra-class"><pre class="language-text"><code>const SimpleEventPlugin = {
    eventTypes:{ 
        'click':{ /* 处理点击事件  */
            phasedRegistrationNames:{
                bubbled: 'onClick',       // 对应的事件冒泡 - onClick 
                captured:'onClickCapture' //对应事件捕获阶段 - onClickCapture
            },
            dependencies: ['click'], //事件依赖
            ...
        },
        'blur':{ /* 处理失去焦点事件 */ },
        ...
    }
    extractEvents:function(topLevelType,targetInst,){ /* eventTypes 里面的事件对应的统一事件处理函数，接下来会重点讲到 */ }
}
</code></pre></div><p>首先事件插件是一个对象，有两个属性，第一个<code>extractEvents</code>作为事件统一处理函数，第二个<code>eventTypes</code>是一个对象，对象保存了原生事件名和对应的配置项<code>dispatchConfig</code>的映射关系。由于v16React的事件是统一绑定在<code>document</code>上的，React用独特的事件名称比如<code>onClick</code>和<code>onClickCapture</code>，来说明我们给绑定的函数到底是在冒泡事件阶段，还是捕获事件阶段执行。</p> <h4 id="_5-registrationnamedependencies"><a href="#_5-registrationnamedependencies" class="header-anchor">#</a> ⑤ registrationNameDependencies</h4> <p><code>registrationNameDependencies</code>用来记录，合成事件比如 <code>onClick</code> 和原生事件 <code>click</code>对应关系。比如 <code>onChange</code> 对应 <code>change</code> , <code>input</code> , <code>keydown</code> , <code>keyup</code>事件。</p> <div class="language- extra-class"><pre class="language-text"><code>{
    onBlur: ['blur'],
    onClick: ['click'],
    onClickCapture: ['click'],
    onChange: ['blur', 'change', 'click', 'focus', 'input', 'keydown', 'keyup', 'selectionchange'],
    onMouseEnter: ['mouseout', 'mouseover'],
    onMouseLeave: ['mouseout', 'mouseover'],
    ...
}
</code></pre></div><h3 id="_2-事件初始化"><a href="#_2-事件初始化" class="header-anchor">#</a> 2 事件初始化</h3> <p>对于事件合成，<code>v16.13.1</code>版本<code>react</code>采用了初始化注册方式。</p> <blockquote><p>react-dom/src/client/ReactDOMClientInjection.js</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>/* 第一步：注册事件：  */
injectEventPluginsByName({
    SimpleEventPlugin: SimpleEventPlugin,
    EnterLeaveEventPlugin: EnterLeaveEventPlugin,
    ChangeEventPlugin: ChangeEventPlugin,
    SelectEventPlugin: SelectEventPlugin,
    BeforeInputEventPlugin: BeforeInputEventPlugin,
});
</code></pre></div><p><code>injectEventPluginsByName</code> 这个函数具体有什么用呢，它在<code>react</code>底层是默认执行的。我们来简化这个函数,看它到底是干什么的。</p> <blockquote><p>legacy-event/EventPluginRegistry.js</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>/* 注册事件插件 */
export function injectEventPluginsByName(injectedNamesToPlugins){
     for (const pluginName in injectedNamesToPlugins) {
         namesToPlugins[pluginName] = injectedNamesToPlugins[pluginName]
     }
     recomputePluginOrdering()
}
</code></pre></div><p><code>injectEventPluginsByName</code>做的事情很简单，形成上述的<code>namesToPlugins</code>，然后执行<code>recomputePluginOrdering</code>，我们接下来看一下<code>recomputePluginOrdering</code>做了写什么？</p> <div class="language- extra-class"><pre class="language-text"><code>const eventPluginOrder = [ 'SimpleEventPlugin' , 'EnterLeaveEventPlugin','ChangeEventPlugin','SelectEventPlugin' , 'BeforeInputEventPlugin' ]

function recomputePluginOrdering(){
    for (const pluginName in namesToPlugins) {
        /* 找到对应的事件处理插件，比如 SimpleEventPlugin  */
        const pluginModule = namesToPlugins[pluginName];
        const pluginIndex = eventPluginOrder.indexOf(pluginName);
        /* 填充 plugins 数组  */
        plugins[pluginIndex] = pluginModule;
    }

    const publishedEvents = pluginModule.eventTypes;
    for (const eventName in publishedEvents) {
       // publishedEvents[eventName] -&gt; eventConfig , pluginModule -&gt; 事件插件 ， eventName -&gt; 事件名称
        publishEventForPlugin(publishedEvents[eventName],pluginModule,eventName,)
    } 
}
】
</code></pre></div><p><strong>recomputePluginOrdering</strong>,作用很明确了，形成上面说的那个<code>plugins</code>,数组。然后就是<strong>重点的函数<code>publishEventForPlugin</code></strong>。</p> <div class="language- extra-class"><pre class="language-text"><code>/*
  dispatchConfig -&gt; 原生事件对应配置项 { phasedRegistrationNames :{  冒泡 捕获  } ，   }
  pluginModule -&gt; 事件插件 比如SimpleEventPlugin  
  eventName -&gt; 原生事件名称。
*/
function publishEventForPlugin (dispatchConfig,pluginModule,eventName){
    eventNameDispatchConfigs[eventName] = dispatchConfig;
    /* 事件 */
    const phasedRegistrationNames = dispatchConfig.phasedRegistrationNames;
    if (phasedRegistrationNames) {
    for (const phaseName in phasedRegistrationNames) {
        if (phasedRegistrationNames.hasOwnProperty(phaseName)) {
            // phasedRegistrationName React事件名 比如 onClick / onClickCapture
            const phasedRegistrationName = phasedRegistrationNames[phaseName];
            // 填充形成 registrationNameModules React 合成事件 -&gt; React 处理事件插件映射关系
            registrationNameModules[phasedRegistrationName] = pluginModule;
            // 填充形成 registrationNameDependencies React 合成事件 -&gt; 原生事件 映射关系
            registrationNameDependencies[phasedRegistrationName] = pluginModule.eventTypes[eventName].dependencies;
        }
    }
    return true;
    }
}
</code></pre></div><p><code>publishEventForPlugin</code> 作用形成上述的 <strong><code>registrationNameModules</code></strong> 和 <strong><code>registrationNameDependencies</code></strong> 对象中的映射关系。</p> <h3 id="_3-事件合成总结"><a href="#_3-事件合成总结" class="header-anchor">#</a> 3 事件合成总结</h3> <p>到这里整个初始化阶段已经完事了，我来总结一下初始化事件合成都做了些什么。这个阶段主要形成了上述的几个重要对象，构建初始化React合成事件和原生事件的对应关系，合成事件和对应的事件处理插件关系。接下来就是事件绑定阶段。</p> <h1 id="三-事件绑定-从一次点击事件开始"><a href="#三-事件绑定-从一次点击事件开始" class="header-anchor">#</a> 三 事件绑定-从一次点击事件开始</h1> <h2 id="事件绑定流程"><a href="#事件绑定流程" class="header-anchor">#</a> 事件绑定流程</h2> <p>如果我们在一个组件中这么写一个点击事件，<code>React</code>会一步步如何处理。</p> <h3 id="_1-diffproperties-处理react合成事件"><a href="#_1-diffproperties-处理react合成事件" class="header-anchor">#</a> 1 diffProperties 处理React合成事件</h3> <div class="language- extra-class"><pre class="language-text"><code>&lt;div&gt;
  &lt;button onClick={ this.handerClick }  className=&quot;button&quot; &gt;点击&lt;/button&gt;
&lt;/div&gt;
</code></pre></div><p>第一步，首先通过上面的讲解，我们绑定给hostComponent种类的fiber(如上的button元素)，会 <code>button</code> 对应的fiber上，以<code>memoizedProps</code> 和 <code>pendingProps</code>形成保存。</p> <div class="language- extra-class"><pre class="language-text"><code>button 对应 fiber
memoizedProps = {
   onClick:function handerClick(){},
   className:'button'
}
</code></pre></div><p>结构图如下所示：</p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片">58E6A4AF-1902-42BC-9D11-B47234037E01.jpg</p> <p>第二步，React在调合子节点后，进入diff阶段，如果判断是<code>HostComponent</code>(dom元素)类型的fiber，会用diff props函数<code>diffProperties</code>单独处理。</p> <blockquote><p>react-dom/src/client/ReactDOMComponent.js</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>function diffProperties(){
    /* 判断当前的 propKey 是不是 React合成事件 */
    if(registrationNameModules.hasOwnProperty(propKey)){
         /* 这里多个函数简化了，如果是合成事件， 传入成事件名称 onClick ，向document注册事件  */
         legacyListenToEvent(registrationName, document）;
    }
}
</code></pre></div><p><code>diffProperties</code>函数在 <code>diff props</code> 如果发现是合成事件(<code>onClick</code>) 就会调用<code>legacyListenToEvent</code>函数。注册事件监听器。</p> <h3 id="_2-legacylistentoevent-注册事件监听器"><a href="#_2-legacylistentoevent-注册事件监听器" class="header-anchor">#</a> 2 legacyListenToEvent 注册事件监听器</h3> <blockquote><p>react-dom/src/events/DOMLegacyEventPluginSystem.js</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>//  registrationName -&gt; onClick 事件
//  mountAt -&gt; document or container
function legacyListenToEvent(registrationName，mountAt){
   const dependencies = registrationNameDependencies[registrationName]; // 根据 onClick 获取  onClick 依赖的事件数组 [ 'click' ]。
    for (let i = 0; i &lt; dependencies.length; i++) {
    const dependency = dependencies[i];
    //这个经过多个函数简化，如果是 click 基础事件，会走 legacyTrapBubbledEvent ,而且都是按照冒泡处理
     legacyTrapBubbledEvent(dependency, mountAt);
  }
}
</code></pre></div><p>legacyTrapBubbledEvent 就是执行将绑定真正的dom事件的函数 legacyTrapBubbledEvent(冒泡处理)。</p> <div class="language- extra-class"><pre class="language-text"><code>function legacyTrapBubbledEvent(topLevelType,element){
   addTrappedEventListener(element,topLevelType,PLUGIN_EVENT_SYSTEM,false)
}
</code></pre></div><p>第三步：在<code>legacyListenToEvent</code>函数中，先找到 <code>React</code> 合成事件对应的原生事件集合，比如 onClick -&gt; ['click'] , onChange -&gt; [<code>blur</code> , <code>change</code> , <code>input</code> , <code>keydown</code> , <code>keyup</code>]，然后遍历依赖项的数组，绑定事件，<strong>这就解释了，为什么我们在刚开始的demo中，只给元素绑定了一个<code>onChange</code>事件，结果在<code>document</code>上出现很多事件监听器的原因，就是在这个函数上处理的。</strong></p> <p>我们上面已经透露了React是采用事件绑定，<code>React</code> 对于 <code>click</code> 等基础事件，会默认按照事件冒泡阶段的事件处理，<strong>不过这也不绝对的，比如一些事件的处理，有些特殊的事件是按照事件捕获处理的。</strong></p> <div class="language- extra-class"><pre class="language-text"><code>case TOP_SCROLL: {                                // scroll 事件
    legacyTrapCapturedEvent(TOP_SCROLL, mountAt); // legacyTrapCapturedEvent 事件捕获处理。
    break;
}
case TOP_FOCUS: // focus 事件
case TOP_BLUR:  // blur 事件
legacyTrapCapturedEvent(TOP_FOCUS, mountAt);
legacyTrapCapturedEvent(TOP_BLUR, mountAt);
break;
</code></pre></div><h3 id="_3-绑定-dispatchevent-进行事件监听"><a href="#_3-绑定-dispatchevent-进行事件监听" class="header-anchor">#</a> 3 绑定 dispatchEvent，进行事件监听</h3> <p>如上述的<code>scroll</code>事件，<code>focus</code> 事件 ，<code>blur</code>事件等，是默认按照事件捕获逻辑处理。接下来就是最重要关键的一步。React是如何绑定事件到<code>document</code>？事件处理函数函数又是什么？问题都指向了上述的<code>addTrappedEventListener</code>，让我们来揭开它的面纱。</p> <div class="language- extra-class"><pre class="language-text"><code>/*
  targetContainer -&gt; document
  topLevelType -&gt;  click
  capture = false
*/
function addTrappedEventListener(targetContainer,topLevelType,eventSystemFlags,capture){
   const listener = dispatchEvent.bind(null,topLevelType,eventSystemFlags,targetContainer) 
   if(capture){
       // 事件捕获阶段处理函数。
   }else{
       /* TODO: 重要, 这里进行真正的事件绑定。*/
      targetContainer.addEventListener(topLevelType,listener,false) // document.addEventListener('click',listener,false)
   }
}
</code></pre></div><p>第四步：这个函数内容虽然不多，但是却非常重要,首先绑定我们的事件统一处理函数 <code>dispatchEvent</code>，绑定几个默认参数，事件类型 <code>topLevelType</code> demo中的<code>click</code> ，还有绑定的容器<code>doucment</code>。<strong>然后真正的事件绑定,添加事件监听器<code>addEventListener</code>。</strong> 事件绑定阶段完毕。</p> <h3 id="_4-事件绑定过程总结"><a href="#_4-事件绑定过程总结" class="header-anchor">#</a> 4 事件绑定过程总结</h3> <p>我们来做一下事件绑定阶段的总结。</p> <ul><li>① 在React，diff DOM元素类型的fiber的props的时候， 如果发现是React合成事件，比如<code>onClick</code>，会按照事件系统逻辑单独处理。</li> <li>② 根据React合成事件类型，找到对应的原生事件的类型，然后调用判断原生事件类型，大部分事件都按照冒泡逻辑处理，少数事件会按照捕获逻辑处理（比如<code>scroll</code>事件）。</li> <li>③ 调用 addTrappedEventListener 进行真正的事件绑定，绑定在<code>document</code>上，<code>dispatchEvent</code> 为统一的事件处理函数。</li> <li>④ <strong>有一点值得注意: 只有上述那几个特殊事件比如 <code>scorll</code>,<code>focus</code>,<code>blur</code>等是在事件捕获阶段发生的，其他的都是在事件冒泡阶段发生的，无论是<code>onClick</code>还是<code>onClickCapture</code>都是发生在冒泡阶段</strong>，至于 React 本身怎么处理捕获逻辑的。我们接下来会讲到。</li></ul> <h1 id="四-事件触发-一次点击事件-在react底层系统会发生什么"><a href="#四-事件触发-一次点击事件-在react底层系统会发生什么" class="header-anchor">#</a> 四 事件触发-一次点击事件，在<code>react</code>底层系统会发生什么？</h1> <div class="language- extra-class"><pre class="language-text"><code>&lt;div&gt;
  &lt;button onClick={ this.handerClick }  className=&quot;button&quot; &gt;点击&lt;/button&gt;
&lt;/div&gt;
</code></pre></div><p>还是上面这段代码片段，当点击一下按钮，在 <code>React</code> 底层会发生什么呢？接下来，让我共同探索事件触发的奥秘。</p> <h2 id="事件触发处理函数-dispatchevent"><a href="#事件触发处理函数-dispatchevent" class="header-anchor">#</a> 事件触发处理函数 dispatchEvent</h2> <p>我们在事件绑定阶段讲过，React事件注册时候，统一的监听器<code>dispatchEvent</code>，也就是当我们<strong>点击按钮之后，首先执行的是<code>dispatchEvent</code>函数</strong>，因为<code>dispatchEvent</code>前三个参数已经被bind了进去，所以真正的事件源对象<code>event</code>，被默认绑定成第四个参数。</p> <blockquote><p>react-dom/src/events/ReactDOMEventListener.js</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>function dispatchEvent(topLevelType,eventSystemFlags,targetContainer,nativeEvent){
    /* 尝试调度事件 */
    const blockedOn = attemptToDispatchEvent( topLevelType,eventSystemFlags, targetContainer, nativeEvent);
}
/*
topLevelType -&gt; click
eventSystemFlags -&gt; 1
targetContainer -&gt; document
nativeEvent -&gt; 原生事件的 event 对象
*/
function attemptToDispatchEvent(topLevelType,eventSystemFlags,targetContainer,nativeEvent){
    /* 获取原生事件 e.target */
    const nativeEventTarget = getEventTarget(nativeEvent)
    /* 获取当前事件，最近的dom类型fiber ，我们 demo中 button 按钮对应的 fiber */
    let targetInst = getClosestInstanceFromNode(nativeEventTarget); 
    /* 重要：进入legacy模式的事件处理系统 */
    dispatchEventForLegacyPluginEventSystem(topLevelType,eventSystemFlags,nativeEvent,targetInst,);
    return null;
}
</code></pre></div><p>在这个阶段主要做了这几件事：</p> <ul><li>① 首先根据真实的事件源对象，找到 <code>e.target</code> 真实的 <code>dom</code> 元素。</li> <li>② 然后根据<code>dom</code>元素，找到与它对应的 <code>fiber</code> 对象<code>targetInst</code>，在我们 <code>demo</code> 中，找到 <code>button</code> 按钮对应的 <code>fiber</code>。</li> <li>③ 然后正式进去<code>legacy</code>模式的事件处理系统，也就是我们目前用的React模式都是<code>legacy</code>模式下的，在这个模式下，批量更新原理，即将拉开帷幕。</li></ul> <p>这里有一点问题，<strong><code>React</code>怎么样通过原生的<code>dom</code>元素，找到对应的<code>fiber</code>的呢？</strong> ，也就是说 <code>getClosestInstanceFromNode</code> 原理是什么？</p> <p>答案是首先 <code>getClosestInstanceFromNode</code> 可以找到当前传入的 <code>dom</code> 对应的最近的元素类型的 <code>fiber</code> 对象。<code>React</code> 在初始化真实 <code>dom</code> 的时候，用一个随机的 <code>key internalInstanceKey</code> 指针指向了当前<code>dom</code>对应的<code>fiber</code>对象，<code>fiber</code>对象用<code>stateNode</code>指向了当前的<code>dom</code>元素。</p> <div class="language- extra-class"><pre class="language-text"><code>// 声明随机key
var internalInstanceKey = '__reactInternalInstance$' + randomKey;

// 使用随机key 
function getClosestInstanceFromNode(targetNode){
  // targetNode -dom  targetInst -&gt; 与之对应的fiber对象
  var targetInst = targetNode[internalInstanceKey];
}
</code></pre></div><p><strong>在谷歌调试器上看</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片">fiber_dom.jpg</p> <p><strong>两者关系图</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片">dom_fiber.jpg</p> <h2 id="legacy-事件处理系统与批量更新"><a href="#legacy-事件处理系统与批量更新" class="header-anchor">#</a> legacy 事件处理系统与批量更新</h2> <blockquote><p>react-dom/src/events/DOMLegacyEventPluginSystem.js</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>/* topLevelType - click事件 ｜ eventSystemFlags = 1 ｜ nativeEvent = 事件源对象  ｜ targetInst = 元素对应的fiber对象  */
function dispatchEventForLegacyPluginEventSystem(topLevelType,eventSystemFlags,nativeEvent,targetInst){
    /* 从React 事件池中取出一个，将 topLevelType ，targetInst 等属性赋予给事件  */
    const bookKeeping = getTopLevelCallbackBookKeeping(topLevelType,nativeEvent,targetInst,eventSystemFlags);
    try { /* 执行批量更新 handleTopLevel 为事件处理的主要函数 */
    batchedEventUpdates(handleTopLevel, bookKeeping);
  } finally {
    /* 释放事件池 */  
    releaseTopLevelCallbackBookKeeping(bookKeeping);
  }
}
</code></pre></div><p>对于v16事件池，我们接下来会讲到，首先 <code>batchedEventUpdates</code>为批量更新的主要函数。我们先来看看<code>batchedEventUpdates</code></p> <blockquote><p>react-dom/src/events/ReactDOMUpdateBatching.js</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>export function batchedEventUpdates(fn,a){
    isBatchingEventUpdates = true;
    try{
       fn(a) // handleTopLevel(bookKeeping)
    }finally{
        isBatchingEventUpdates = false
    }
}
</code></pre></div><p>批量更新简化成如上的样子，从上面我们可以看到，React通过开关<code>isBatchingEventUpdates</code>来控制是否启用批量更新。<code>fn(a)</code>，事件上调用的是 <code>handleTopLevel(bookKeeping)</code>，由于js是单线程的，我们真正在组件中写的事件处理函数，比如demo 的 <code>handerClick</code>实际执行是在<code>handleTopLevel(bookKeeping)</code>中执行的。所以如果我们在<code>handerClick</code>里面触发<code>setState</code>，那么就能读取到<code>isBatchingEventUpdates = true</code>这就是React的合成事件为什么具有批量更新的功能了。比如我们这么写</p> <div class="language- extra-class"><pre class="language-text"><code>state={number:0}
handerClick = () =&gt;{
    this.setState({number: this.state.number + 1   })
    console.log(this.state.number) //0
    this.setState({number: this.state.number + 1   })
    console.log(this.state.number) //0
    setTimeout(()=&gt;{
        this.setState({number: this.state.number + 1   })
        console.log(this.state.number) //2
        this.setState({number: this.state.number + 1   })
        console.log(this.state.number)// 3
    })
}
</code></pre></div><p>如上述所示，第一个<code>setState</code>和第二个<code>setState</code>在批量更新条件之内执行，所以打印不会是最新的值，但是如果是发生在<code>setTimeout</code>中,由于eventLoop 放在了下一次事件循环中执行，此时 batchedEventUpdates 中已经执行完<code>isBatchingEventUpdates = false</code>，所以批量更新被打破，我们就可以直接访问到最新变化的值了。</p> <p>接下来我们有两点没有梳理：</p> <ul><li>一是React事件池概念</li> <li>二是最后的线索是执行<code>handleTopLevel(bookKeeping)</code>，那么<code>handleTopLevel</code>到底做了写什么。</li></ul> <h2 id="执行事件插件函数"><a href="#执行事件插件函数" class="header-anchor">#</a> 执行事件插件函数</h2> <p>上面说到整个事件系统，最后指向函数 <code>handleTopLevel(bookKeeping)</code> 那么 <code>handleTopLevel</code> 到底做了什么事情？</p> <div class="language- extra-class"><pre class="language-text"><code>// 流程简化后
// topLevelType - click  
// targetInst - button Fiber
// nativeEvent
function handleTopLevel(bookKeeping){
    const { topLevelType,targetInst,nativeEvent,eventTarget, eventSystemFlags} = bookKeeping
    for(let i=0; i &lt; plugins.length;i++ ){
        const possiblePlugin = plugins[i];
        /* 找到对应的事件插件，形成对应的合成event，形成事件执行队列  */
        const  extractedEvents = possiblePlugin.extractEvents(topLevelType,targetInst,nativeEvent,eventTarget,eventSystemFlags)  
    }
    if (extractedEvents) {
        events = accumulateInto(events, extractedEvents);
    }
    /* 执行事件处理函数 */
    runEventsInBatch(events);
}
</code></pre></div><p>我把整个流程简化，只保留了核心的流程，<code>handleTopLevel</code>最后的处理逻辑就是执行我们说的事件处理插件(SimpleEventPlugin)中的处理函数<code>extractEvents</code>，比如我们demo中的点击事件 onClick 最终走的就是 <code>SimpleEventPlugin</code> 中的 <code>extractEvents</code> 函数，那么React为什么这么做呢? 我们知道我们React是采取事件合成，事件统一绑定，并且我们写在组件中的事件处理函数( handerClick )，也不是真正的执行函数<code>dispatchAciton</code>，那么我们在<code>handerClick</code>的事件对象 <code>event</code>,也是React单独合成处理的，里面单独封装了比如 <code>stopPropagation</code>和<code>preventDefault</code>等方法，<strong>这样的好处是，我们不需要跨浏览器单独处理兼容问题，交给React底层统一处理。</strong></p> <h2 id="extractevents-形成事件对象event-和-事件处理函数队列"><a href="#extractevents-形成事件对象event-和-事件处理函数队列" class="header-anchor">#</a> extractEvents 形成事件对象event 和 事件处理函数队列</h2> <p><strong>重点来了！重点来了！重点来了！</strong>，extractEvents 可以作为整个事件系统核心函数，我们先回到最初的<code>demo</code>，如果我们这么写,那么四个回调函数，那么点击按钮，四个事件是如何处理的呢。首先如果点击按钮，最终走的就是<code>extractEvents</code>函数，一探究竟这个函数。</p> <blockquote><p>legacy-events/SyntheticEvent.js</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>const  SimpleEventPlugin = {
    extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){
        const dispatchConfig = topLevelEventsToDispatchConfig.get(topLevelType);
        if (!dispatchConfig) {
            return null;
        }
        switch(topLevelType){
            default:
            EventConstructor = SyntheticEvent;
            break;
        }
        /* 产生事件源对象 */
        const event = EventConstructor.getPooled(dispatchConfig,targetInst,nativeEvent,nativeEventTarget)
        const phasedRegistrationNames = event.dispatchConfig.phasedRegistrationNames;
        const dispatchListeners = [];
        const {bubbled, captured} = phasedRegistrationNames; /* onClick / onClickCapture */
        const dispatchInstances = [];
        /* 从事件源开始逐渐向上，查找dom元素类型HostComponent对应的fiber ，收集上面的React合成事件，onClick / onClickCapture  */
         while (instance !== null) {
              const {stateNode, tag} = instance;
              if (tag === HostComponent &amp;&amp; stateNode !== null) { /* DOM 元素 */
                   const currentTarget = stateNode;
                   if (captured !== null) { /* 事件捕获 */
                        /* 在事件捕获阶段,真正的事件处理函数 */
                        const captureListener = getListener(instance, captured);
                        if (captureListener != null) {
                        /* 对应发生在事件捕获阶段的处理函数，逻辑是将执行函数unshift添加到队列的最前面 */
                            dispatchListeners.unshift(captureListener);
                            dispatchInstances.unshift(instance);
                            dispatchCurrentTargets.unshift(currentTarget);
                        }
                    }
                    if (bubbled !== null) { /* 事件冒泡 */
                        /* 事件冒泡阶段，真正的事件处理函数，逻辑是将执行函数push到执行队列的最后面 */
                        const bubbleListener = getListener(instance, bubbled);
                        if (bubbleListener != null) {
                            dispatchListeners.push(bubbleListener);
                            dispatchInstances.push(instance);
                            dispatchCurrentTargets.push(currentTarget);
                        }
                    }
              }
              instance = instance.return;
         }
          if (dispatchListeners.length &gt; 0) {
              /* 将函数执行队列，挂到事件对象event上 */
            event._dispatchListeners = dispatchListeners;
            event._dispatchInstances = dispatchInstances;
            event._dispatchCurrentTargets = dispatchCurrentTargets;
         }
        return event
    }
}
</code></pre></div><p>事件插件系统的核心<code>extractEvents</code>主要做的事是:</p> <ul><li>① 首先形成<code>React</code>事件独有的合成事件源对象，这个对象，保存了整个事件的信息。将作为参数传递给真正的事件处理函数(handerClick)。</li> <li>② 然后声明事件执行队列 ，按照<code>冒泡</code>和<code>捕获</code>逻辑，从事件源开始逐渐向上，查找dom元素类型HostComponent对应的fiber ，收集上面的 <code>React</code> 合成事件，例如 <code>onClick</code> / <code>onClickCapture</code> ，对于冒泡阶段的事件(<code>onClick</code>)，将 <code>push</code> 到执行队列后面 ， 对于捕获阶段的事件(<code>onClickCapture</code>)，将 <code>unShift</code>到执行队列的前面。</li> <li>③ 最后将事件执行队列，保存到React事件源对象上。等待执行。</li></ul> <p>举个例子比如如下</p> <div class="language- extra-class"><pre class="language-text"><code>handerClick = () =&gt; console.log(1)
handerClick1 = () =&gt; console.log(2)
handerClick2 = () =&gt; console.log(3) 
handerClick3= () =&gt; console.log(4)
render(){
    return &lt;div onClick={ this.handerClick2 } onClickCapture={this.handerClick3}  &gt; 
        &lt;button onClick={ this.handerClick }  onClickCapture={ this.handerClick1  }  className=&quot;button&quot; &gt;点击&lt;/button&gt;
    &lt;/div&gt;
}
</code></pre></div><p>打印 // 4  2  1  3</p> <p>看到这里我们应该知道上述函数打印顺序为什么了吧，首先遍历 <code>button</code> 对应的fiber，首先遇到了 <code>onClickCapture</code> ,将 <code>handerClick1</code> 放到了数组最前面，然后又把<code>onClick</code>对应<code>handerClick</code>的放到数组的最后面，形成的结构是<code>[ handerClick1 , handerClick ]</code>， 然后向上遍历，遇到了<code>div</code>对应fiber,将<code>onClickCapture</code>对应的<code>handerClick3</code>放在了数组前面，将<code>onClick</code>对应的 <code>handerClick2</code> 放在了数组后面，形成的结构 <code>[ handerClick3,handerClick1 , handerClick,handerClick2 ]</code> ,所以执行的顺序 // 4  2  1  3，就是这么简单，完美！</p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片">FDEBA681-2E03-420B-A838-5907439837A9.jpg</p> <h2 id="事件触发"><a href="#事件触发" class="header-anchor">#</a> 事件触发</h2> <p>有的同学可能好奇React的事件源对象是什么样的，以上面代码中<code>SyntheticEvent</code>为例子我们一起来看看：</p> <blockquote><p>legacy-events/SyntheticEvent.js/</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>function SyntheticEvent( dispatchConfig,targetInst,nativeEvent,nativeEventTarget){
  this.dispatchConfig = dispatchConfig;
  this._targetInst = targetInst;
  this.nativeEvent = nativeEvent;
  this._dispatchListeners = null;
  this._dispatchInstances = null;
  this._dispatchCurrentTargets = null;
  this.isPropagationStopped = () =&gt; false; /* 初始化，返回为false  */

}
SyntheticEvent.prototype={
    stopPropagation(){ this.isPropagationStopped = () =&gt; true;  }, /* React单独处理，阻止事件冒泡函数 */
    preventDefault(){ },  /* React单独处理，阻止事件捕获函数  */
    ...
}
</code></pre></div><p>在 <code>handerClick</code> 中打印 <code>e</code> :</p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片">B9180401-93FF-4EF0-A2FB-C2FA43B29550.jpg</p> <p>既然事件执行队列和事件源对象都形成了，接下来就是最后一步<strong>事件触发</strong>了。上面大家有没有注意到一个函数<code>runEventsInBatch</code>，所有事件绑定函数，就是在这里触发的。让我们一起看看。</p> <blockquote><p>legacy-events/EventBatching.js</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>function runEventsInBatch(){
    const dispatchListeners = event._dispatchListeners;
    const dispatchInstances = event._dispatchInstances;
    if (Array.isArray(dispatchListeners)) {
    for (let i = 0; i &lt; dispatchListeners.length; i++) {
      if (event.isPropagationStopped()) { /* 判断是否已经阻止事件冒泡 */
        break;
      }
      
      dispatchListeners[i](event)
    }
  }
  /* 执行完函数，置空两字段 */
  event._dispatchListeners = null;
  event._dispatchInstances = null;
}
</code></pre></div><p><code>dispatchListeners[i](event)</code>就是执行我们的事件处理函数比如<code>handerClick</code>,从这里我们知道，<strong>我们在事件处理函数中，返回 false ，并不会阻止浏览器默认行为</strong>。</p> <div class="language- extra-class"><pre class="language-text"><code>handerClick(){ //并不能阻止浏览器默认行为。
    return false
}
</code></pre></div><p>应该改成这样：</p> <div class="language- extra-class"><pre class="language-text"><code>handerClick(e){
    e.preventDefault()
}
</code></pre></div><p>另一方面React对于阻止冒泡，就是通过isPropagationStopped，判断是否已经阻止事件冒泡。如果我们在事件函数执行队列中，某一会函数中，调用<code>e.stopPropagation()</code>，就会赋值给<code>isPropagationStopped=()=&gt;true</code>，当再执行 <code>e.isPropagationStopped()</code>就会返回 <code>true</code> ,接下来事件处理函数，就不会执行了。</p> <h2 id="其他概念-事件池"><a href="#其他概念-事件池" class="header-anchor">#</a> 其他概念-事件池</h2> <div class="language- extra-class"><pre class="language-text"><code> handerClick = (e) =&gt; {
    console.log(e.target) // button 
    setTimeout(()=&gt;{
        console.log(e.target) // null
    },0)
}
</code></pre></div><p>对于一次点击事件的处理函数，在正常的函数执行上下文中打印<code>e.target</code>就指向了<code>dom</code>元素，但是在<code>setTimeout</code>中打印却是<code>null</code>，如果这不是React事件系统，两次打印的应该是一样的，但是为什么两次打印不一样呢？<strong>因为在React采取了一个事件池的概念，每次我们用的事件源对象，在事件函数执行之后，可以通过<code>releaseTopLevelCallbackBookKeeping</code>等方法将事件源对象释放到事件池中，这样的好处每次我们不必再创建事件源对象，可以从事件池中取出一个事件源对象进行复用，在事件处理函数执行完毕后,会释放事件源到事件池中，清空属性，这就是<code>setTimeout</code>中打印为什么是<code>null</code>的原因了。</strong></p> <h2 id="事件触发总结"><a href="#事件触发总结" class="header-anchor">#</a> 事件触发总结</h2> <p>我把事件触发阶段做的事总结一下：</p> <ul><li><strong>①首先通过统一的事件处理函数 <code>dispatchEvent</code>,进行批量更新batchUpdate。</strong></li> <li><strong>②然后执行事件对应的处理插件中的<code>extractEvents</code>，合成事件源对象,每次React会从事件源开始，从上遍历类型为 hostComponent即 dom类型的fiber,判断props中是否有当前事件比如onClick,最终形成一个事件执行队列，React就是用这个队列，来模拟事件捕获-&gt;事件源-&gt;事件冒泡这一过程。</strong></li> <li><strong>③最后通过<code>runEventsInBatch</code>执行事件队列，如果发现阻止冒泡，那么break跳出循环，最后重置事件源，放回到事件池中，完成整个流程。</strong></li></ul> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片">evnent_click.jpg</p> <h1 id="五-关于react-v17版本的事件系统"><a href="#五-关于react-v17版本的事件系统" class="header-anchor">#</a> 五 关于react v17版本的事件系统</h1> <p>React v17 整体改动不是很大，但是事件系统的改动却不小，首先上述的很多执行函数，在v17版本不复存在了。我来简单描述一下v17事件系统的改版。</p> <p><strong>1 事件统一绑定container上，ReactDOM.render(app， container);而不是document上，这样好处是有利于微前端的，微前端一个前端系统中可能有多个应用，如果继续采取全部绑定在<code>document</code>上，那么可能多应用下会出现问题。</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片">react_17_delegation.png</p> <p><strong>2 对齐原生浏览器事件</strong></p> <p><code>React 17</code>中终于支持了原生捕获事件的支持， 对齐了浏览器原生标准。同时 <code>onScroll</code> 事件不再进行事件冒泡。<code>onFocus</code> 和 <code>onBlur</code> 使用原生 <code>focusin</code>， <code>focusout</code> 合成。</p> <p><strong>3 取消事件池</strong><code>React 17</code>取消事件池复用，也就解决了上述在<code>setTimeout</code>打印，找不到<code>e.target</code>的问题。</p> <h1 id="六-总结"><a href="#六-总结" class="header-anchor">#</a> 六 总结</h1> <p>本文从<strong>事件合成</strong>，<strong>事件绑定</strong>，<strong>事件触发</strong>三个方面详细介绍了React事件系统原理，希望大家能通过这篇文章更加深入了解v16 React 事件系统，如果有疑问和不足之处，也希望大家能在评论区指出。</p> <p>最后, 送人玫瑰，手留余香，觉得有收获的朋友可以给笔者<strong>点赞，关注</strong>一波 ，陆续更新前端超硬核文章。</p> <p>提前透漏：接下来会出一部揭秘<code>react</code>调度系统的文章。感兴趣的同学请关注公众号 <strong>前端Sharing</strong> 第一时间更新前端硬文。</p> <h2 id="往期react文章"><a href="#往期react文章" class="header-anchor">#</a> 往期react文章</h2> <p><strong>React进阶系列</strong></p> <p><a href="http://mp.weixin.qq.com/s?__biz=Mzg5MjMxMzY5Mw==&amp;mid=2247484812&amp;idx=1&amp;sn=d38f85074461912dfd53d5afb2a73646&amp;chksm=cfc14cbef8b6c5a81095205f9f82c4b308455f36d261743807b3361e1d1fd5c612a25aaeca68&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">「React进阶」 React全部api解读+基础实践大全(夯实基础万字总结)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://mp.weixin.qq.com/s?__biz=Mzg5MjMxMzY5Mw==&amp;mid=2247484634&amp;idx=1&amp;sn=618673960ee73b55df82efe886fd6cdd&amp;chksm=cfc14de8f8b6c4fed909929339dd7ed4092af462de88150767173baea4a7fcb3e3ed501daefd&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">「react进阶」一文吃透react-hooks原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://mp.weixin.qq.com/s?__biz=Mzg5MjMxMzY5Mw==&amp;mid=2247484613&amp;idx=1&amp;sn=c97b435638d9b21c8869d4e51e3a295a&amp;chksm=cfc14df7f8b6c4e19707a17691c16f43282ad10abc0fb046d4bdf5e4a83e0057e6ab72510e1e&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">「react进阶」一文吃透React高阶组件(HOC)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://mp.weixin.qq.com/s?__biz=Mzg5MjMxMzY5Mw==&amp;mid=2247484275&amp;idx=1&amp;sn=d0a2f61cfaf0004d9683c7b940ce704e&amp;chksm=cfc14a41f8b6c35772077397e778060c7849ff8a73faf2a38c570215b2d3c924d1d6e87a28b2&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">「react进阶」年终送给react开发者的八条优化建议<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <ul><li>react源码</li> <li>React 事件系统工作原理</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">11/8/2024, 10:19:43 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/4-事件机制/react事件系统原理.html" class="prev">
        React 事件系统原理
      </a></span> <span class="next"><a href="/react/4-事件机制/一文读懂React组件渲染核心原理.html">
        一文读懂 React 组件渲染核心原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.ae400df5.js" defer></script><script src="/assets/js/2.57da4f88.js" defer></script><script src="/assets/js/1.a76cc220.js" defer></script><script src="/assets/js/492.088a7e6e.js" defer></script>
  </body>
</html>
